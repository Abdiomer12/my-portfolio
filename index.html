<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Excel - Exam Converter</title>
    <!-- Waxaan isticmaalaynaa Libraries caawinaya akhrinta PDF iyo samaynta Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 450px; }
        h2 { color: #2c3e50; margin-bottom: 20px; }
        input[type="file"] { margin-bottom: 20px; display: block; width: 100%; }
        button { background-color: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background-color: #219150; }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #status { margin-top: 15px; color: #7f8c8d; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2>PDF to Excel Converter</h2>
    <p>Gali faylka PDF-ka ee su'aalaha ah:</p>
    <input type="file" id="pdfInput" accept="application/pdf">
    <button id="convertBtn">Bedel oo soo saar Excel</button>
    <div id="status"></div>
</div>

<script>
    // In loo sheego browser-ka halka uu ka helayo PDF workers
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    document.getElementById('convertBtn').addEventListener('click', async () => {
        const fileInput = document.getElementById('pdfInput');
        const status = document.getElementById('status');
        
        if (fileInput.files.length === 0) {
            alert("Fadlan marka hore dooro fayl PDF ah!");
            return;
        }

        status.innerText = "Waa lala soo baxayaa xogta... fadlan sug.";
        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = async function() {
            const typedarray = new Uint8Array(this.result);
            const pdf = await pdfjsLib.getDocument(typedarray).promise;
            let fullText = "";

            // 1. Akhrinta dhammaan boggaga PDF-ka
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(" ");
                fullText += pageText + "\n";
            }

            processData(fullText);
        };
        reader.readAsArrayBuffer(file);
    });

    function processData(text) {
        // Tani waa qaybta xogta u kala jebinaysa Question iyo Options
        // Waxay raadinaysaa qaabka "1. Su'aasha..."
        const lines = text.split(/\d+\./); 
        const data = [];

        // Madaxa Excel-ka (Headers) sida sawirkaaga ka muuqata
        data.push(["Question", "Option1", "Option2", "Option3", "Option4", "CorrectAnswer"]);

        lines.forEach((line, index) => {
            if (index === 0 || line.trim() === "") return;

            // Isku day inaad xogta u kala qaybiso su'aal iyo dookhyo
            // Fiiro gaar ah: Tani waxay ku xirantahay sida PDF-kaagu u qoran yahay
            let parts = line.split(/(?=[A-D]\)|[A-D]\.)/); // Waxay raadinaysaa A) ama A.
            
            let question = parts[0]?.trim() || "N/A";
            let opt1 = parts[1]?.replace(/^[A-D][\.\)]\s*/, "").trim() || "";
            let opt2 = parts[2]?.replace(/^[A-D][\.\)]\s*/, "").trim() || "";
            let opt3 = parts[3]?.replace(/^[A-D][\.\)]\s*/, "").trim() || "";
            let opt4 = parts[4]?.replace(/^[A-D][\.\)]\s*/, "").trim() || "";
            let correct = ""; // PDF-ku inta badan ma sheego jawaabta saxda ah haddaan si gaar ah loo calaamadin

            data.push([question, opt1, opt2, opt3, opt4, correct]);
        });

        createExcel(data);
    }

    function createExcel(data) {
        const status = document.getElementById('status');
        
        // Sameynta Workbook-ga Excel
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);

        // Ku darista sheet-ka
        XLSX.utils.book_append_sheet(wb, ws, "Exam Data");

        // Soo dejinta faylka
        XLSX.writeFile(wb, "History_Exam_Converted.xlsx");
        
        status.innerText = "Waa la dhameeyay! Faylkii Excel-ka waa kuu soo degay.";
    }
</script>

</body>
</html>
